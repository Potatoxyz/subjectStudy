<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="../plugin/normalizeCss/normalize.css">
    <link rel="stylesheet" href="../plugin/animate/animate.css">
    <link rel="stylesheet" href="../plugin/bootstrap3/bootstrap.css">
    <link rel="stylesheet" href="../plugin/slide/jquery.fullpage.css">
    <link rel="stylesheet" href="../plugin/cuttomInputFile/inputFile.css">
    <link rel="stylesheet" href="../css/public.css">
    <link rel="stylesheet" href="../css/index-frame.css">
    <link rel="stylesheet" href="../css/index-flexiable.css">
    <link rel="stylesheet" href="../plugin/bootstrap3/bootstrap-theme.min.css">
    <title>《应用水文地球化学》</title>
</head>
<style>
    .rightBar .action{
        padding:8px;
    }
    .rightBar .action>span{
        display: inline-block;
        padding:10px;
        border-radius: 50%;
    }
    .rightBar .file-list{
        padding:0 8px;
    }
    .rightBar .file-list li{
        display: flex;
        align-items: center;
        border-radius:5px;
        padding:5px;
        background: linear-gradient(to bottom,#000,#696969);
    }
    .rightBar .file-list li .file-icon,.rightBar .file-list li .editFileName{
        width: 15%;
        text-align: center;
    }
    .rightBar .file-list li p{
        width: 70%;
        text-align: center;

        overflow: hidden;
        text-overflow:ellipsis;
        white-space: nowrap;
    }
    .rightBar .tab-content{
        position: absolute;
        top:60px;
        width: 300px;
        height: calc( 100vh - 60px);
        overflow: auto;
        transition: all ease 0.5s;
    }
    .rightBar #tab1-content{
        left: 0;
    }
    .rightBar #tab2-content{
        left: 100%;
    }
    .rightBar #tab3-content{
        left: 200%;
    }
    .bar {
        height: 18px;
        background: green;
    }
    .upload-item{
        display: flex;
        flex-wrap: nowrap;
        align-items: center;
        margin-bottom: 10px;
    }
    .upload-item span{
        text-align: center;
    }
    .upload-item span.file-action a{
        padding:2px;
        border-radius: 1px;
    }
    .upload-item span.file-action a:first-of-type{
        margin-right: 8px;
    }
    .upload-item span:nth-of-type(1){
        width: 100px;
    }
    .upload-item span:nth-of-type(2){
        width: 100px;
    }
    .upload-item span:nth-of-type(3){
        width: 100px;
    }
    .upload-item span.file-detail i{
        display: block;
    }
    .progress{
        margin-bottom: 0;
    }
    .uploader{
        width: 100%;
        margin-bottom: 0;
    }
</style>
<body>
    <nav>
        <div class="nav-wrap">
        <div class="left-fun none"><span id="leftBar" class="glyphicon glyphicon-align-left radius3"></span></div>
        <h3>《应用水文地球化学》</h3>
        <div class="topbarFun-wrap flex">
            <span class="name">David</span>
            <span class="img-wrap"><img src="../img/Wolf.jpg" width="50" height="50" alt="头像"></span>
            <span id="rightFun" class="glyphicon glyphicon-th"></span>
        </div>
        </div>
    </nav>
    <div class="sideBar" id="sideBar">
        <ul>
            <li>
                <div class="link-wrap">
                    <a class="link text-left" href="javascript:;">Page1</a>
                </div>
                <div class="icon-box active-box flex">
                    <i class="glyphicon glyphicon-home white-text fa-2x noCusor"></i>
                </div>
            </li>
            <li>
                <div class="link-wrap">
                    <a class="link text-left" href="javascript:;">Page2</a>
                </div>
                <div class="icon-box flex">
                    <i class="glyphicon glyphicon-home white-text fa-2x noCusor"></i>
                </div>
            </li>
        </ul>
    </div>
    <div class="rightBar" id="rightBar">
        <div class="tab flex">
            <div class="close">
                <i id="closeRightFun" class="glyphicon glyphicon-chevron-right white-text"></i>
            </div>
            <input id="tab1" type="radio" value="tab1" name="tab" checked>
            <label for="tab1">PDF</label>

            <input id="tab2" type="radio" value="tab2" name="tab">
            <label for="tab2">视频</label>

            <input id="tab3" type="radio" value="tab3" name="tab">
            <label for="tab3">聊天</label>
        </div>

        <div id="tab1-content" class="tab-content">
        <div class="action">
            <span class="mybg-primary"><i class="glyphicon glyphicon-plus fa-2x"></i></span>
            <span class="mybg-error right"><i class="glyphicon glyphicon-trash fa-2x"></i></span>
        </div>
        <ul class="file-list">
            <li>
                <span class="file-icon"><i class="glyphicon glyphicon-folder-open fa-2x"></i></span>
                <p>
                    <span>filename</span>
                </p>
                <span class="editFileName"><i class="glyphicon glyphicon-pencil fa-1-5x"></i></span>
            </li>
        </ul>
        </div>
        <div id="tab2-content" class="tab-content">
            <form id="fileupload">
                 <div class="uploader black">
                 <input type="text" class="filename" readonly/>
                 <input type="button" name="file" class="button" value="Browse..."/>
                 <input type="file"size="30"/>
                 </div>
            <div style="height: 20px;">
                    <div class="progress none" id="progress">
                        <div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100">
                        </div>
                    </div>
            </div>
            </form>
            <div class="info-wrap">
                <div id="preview-title" class="upload-item none">
                    <span>预览</span>
                    <span>详情</span>
                    <span>操作</span>
                </div>
            </div>
        </div>
        <div id="tab3-content" class="tab-content">
            <p>tab3</p>
        </div>

    </div>
    <div class="body">

    </div>
</body>
<script src="../plugin/jquery/jquery-3.2.1.min.js"></script>
<script src="../plugin/bootstrap3/bootstrap.min.js"></script>
<script src="../plugin/cuttomInputFile/inputfile.js"></script>
<script src="../plugin/jquery-file-upload/jquery.ui.widget.js"></script>
<script src="../plugin/jquery-file-upload/jquery.iframe-transport.js"></script>
<script src="../plugin/jquery-file-upload/jquery.fileupload.js"></script>
<script src="../plugin/jquery-file-upload/load-image.all.min.js"></script>
<script src="../js/index-toggleBar.js"></script>
<script src="../js/index-rightBar-innerToggle.js"></script>
<script id="download-preview" type="text/html">
</script>
<script>
    $(function () {
        //初始化左右两边的bar切换
        toggleBar();
        //rightBar内部tab切换
        rightBarInner();
        //初始化上传文件用那个样式
        initInputFile();
        var removeFileItem=function (_this) {
            _this.css('position','relative')
                .animate(
                    {
                        left:'-100%'
                    },
                    {
                        duration:500,
                        complete:function () {
                            $(this).remove();
                        }
                    }
                );
        };
        var previewId=1;
        $('#fileupload').fileupload({
            url:'http://localhost:8081/uploa',

            //进度条
            progressall: function (e, data) {
                var progress = parseInt(data.loaded / data.total * 100, 10);
                $('#progress .progress-bar').css(
                    'width',
                    progress + '%'
                );
                if(progress===100){
                    $('#progress').addClass('none');
                }
            },
            //上传结果
            done:function (e,data) {
                console.log(data.result.result);
                console.log(e);
                    var target=$(data.context).text('')
                        .addClass('glyphicon glyphicon-ok')
                        .unbind('click');
                    target.next().text('关闭').click(function () {
                        removeFileItem($(this).parents('.upload-item'));
                    })
            },
            fail:function (e,data) {
                $(data.context).text('')
                    .removeClass('mybg-primary')
                    .addClass('glyphicon glyphicon-remove mybg-error')
                    .unbind('click');
            },
            add: function (e, data) {
                console.log(e);
                var filesize;
                var unit;
                var fileName=data.files[0].name;
                var s1=data.files[0].size/1024;
                var s2=data.files[0].size/1024/1024;
                if(s1<1024){
                    filesize=s1.toFixed(2);
                    unit='KB';
                }
                if(s1>1024){
                    filesize=s2.toFixed(2);
                    unit='M';
                }
                loadImage(
                    data.files[0],
                    function (img) {
                        $('#preview-title').removeClass('none');
                        $('#tab2-content .info-wrap').append('<div class="upload-item animated" id='+previewId+'>\n' +
                            '                    <span class="preview-img"></span>\n' +
                            '                    <span class="file-detail"></span>\n' +
                            '                    <span class="file-action"></span>\n' +
                            '                </div>');
                        $('#'+previewId+' '+'.preview-img').append(img);
                        $('#'+previewId+' '+'.file-detail').append('<i class="size">'+fileName+'</i>');
                        $('#'+previewId+' '+'.file-detail').append('<i class="fileName">'+filesize+' '+unit+'</i>');
                        $('<a href="javascript:;" class="mybg-primary">上传</a>').appendTo($('#'+previewId+' '+'.file-action'))
                            .click(function () {
                                data.context=$(this);
                                $('#progress').removeClass('none');
                                data.submit();
                            });
                        $('<a href="javascript:;" class="mybg-warning">取消</a>').appendTo($('#'+previewId+' '+'.file-action'))
                            .click(function () {
                                removeFileItem($(this).parents('.upload-item'));
                            });
                        previewId++;
                    },
                    {maxWidth: 70}
                );
            }
        })
    })
</script>
</html>